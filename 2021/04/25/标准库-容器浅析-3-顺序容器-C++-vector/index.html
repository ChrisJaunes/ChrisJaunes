<!DOCTYPE html>
<html lang="en" >
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="description" content="欢迎来的ChrisJaunes的世界">
	<meta name="keywords" content="chrisjaunes">
	<title>标准库-容器浅析-3-顺序容器-C++-vector - ChrisJaunes</title>
	
	<link rel="shortcut icon" href="/ChrisJaunes/imgs/avatar.jpg"/>
	
<link rel="stylesheet" href="/ChrisJaunes/css/style.css">

	
<link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<meta name="generator" content="Hexo 5.3.0"></head>
<body>
	<div class="main-con">
<nav class="nav cl">
    <ul class="cl nav-list">
        <li>
            <a href="/ChrisJaunes/" class="">
                <i class="fa fa-home"></i> 
                <span>主页</span>
            </a>
        </li>
        <li>
            <a href="/ChrisJaunes/archives/" class="">
                <i class=" fa-"></i> 
                <span>归档</span>
            </a>
        </li>
        <li>
            <a href="javascript:void(0)" class="">
                <i class=" fa-"></i> 
                <span>关于</span>
                <span class="drop-flag fa fa-angle-down"></span>
            </a>
            <dl>
                <li>
                    <a href="/ChrisJaunes/about" class="">
                    <i class=" fa-"></i>
                    <span>关于本站</span>
                    </a>
                </li>
            </dl>
        </li>
    </ul>
    <ul class="cl nav-tool">
        <li>
            <a target="_blank" rel="noopener" href="https://github.com/ChrisJaunes">
                <i class="fa fa-github"></i>
            </a>
        </li>
        <li>
            <a href="mailto:judgehuang@tencent.com">
                <i class="fa fa-envelope"></i>
            </a>
        </li>
        <li>
            <a href="javascript:void(0)" class="nav-search-btn">
                <i class="fa fa-search"></i>
            </a>
        </li>
    </ul>
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="nav-search"><input type="search" name="q" class="nav-search-input" placeholder="search..."><input type="hidden" name="sitesearch" value="https://chrisjaunes.github.io"></form>
</nav>

        
<div class="con-wrap fadeToTop">
    <section class="article-area">
        
<article class="article">
    <div class="article-wrap">
        <h2 class="article-title cl">
            <a href="/ChrisJaunes/2021/04/25/%E6%A0%87%E5%87%86%E5%BA%93-%E5%AE%B9%E5%99%A8%E6%B5%85%E6%9E%90-3-%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8-C++-vector/" title="标准库-容器浅析-3-顺序容器-C++-vector">
                标准库-容器浅析-3-顺序容器-C++-vector
            </a>
        </h2>
        <ul class="article-extra" style="margin-bottom: 20px">
            <li class="article-time">
                2021-04-25
            </li> 
            <li class="article-category">
                <ol class="category-list cl">
                    <i class="fa fa-folder-o"></i>
                        <li><a href="/categories/programing_language/">programing_language</a></li>
                        <li><a href="/categories/C++/">C++</a></li>
                </ol>
            </li>
        </ul>
        <div class="article-description">
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1><span id="c-shun-xu-rong-qi-qian-xi">C++顺序容器浅析</span><a href="#c-shun-xu-rong-qi-qian-xi" class="header-anchor"> </a></h1>
<h2><span id="vector-rong-qi">Vector 容器</span><a href="#vector-rong-qi" class="header-anchor"> </a></h2>
<h3><span id="vector-jie-shao">vector介绍</span><a href="#vector-jie-shao" class="header-anchor"> </a></h3>
<p>标准库类型vector表示对象的集合，其中所有对象的类型都相同。集合中的每个对象都有一个与之对应的索引，索引用于访问对象。</p>
<p>从实现上看，vector是一个类模板。模板可以看作编译器生成类或者函数的一份说明，编译器根据模板创建类或者函数的过程被称作实例化，使用模板的时候，需要指出编译器应该把类或者函数实例化为何种类型。</p>
<p>在C++中容器是使用模板编写的，vector、deque、list、forward_list等顺序容器的模板参数为</p>
<pre><code class="hljs c++"><span class="hljs-keyword">template</span> &lt; <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span>, <span class="hljs-keyword">class</span> <span class="hljs-title">Alloc</span> =</span> allocator&lt;T&gt; &gt;</code></pre>
<p>STL容器采用分配器来完成对内存空间的动态分配，迭代器可以访问容器的底层实现，即迭代器可以访问分配器。</p>
<p>分析包括容器的常见接口、容器迭代器</p>
<p>LLVM是C++标准的一个实现。<br>
源码的github地址: <a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/tree/main/libcxx/include">https://github.com/llvm/llvm-project/tree/main/libcxx/include</a></p>
<p>GNU G++ 是C++标准的一个实现,<br>
源码的github地址: <a target="_blank" rel="noopener" href="https://github.com/gcc-mirror/gcc/tree/releases/gcc-11/libstdc%2B%2B-v3/include">https://github.com/gcc-mirror/gcc/tree/releases/gcc-11/libstdc%2B%2B-v3/include</a></p>
<h3><span id="vector-de-ding-yi-he-chu-shi-hua">vector的定义和初始化</span><a href="#vector-de-ding-yi-he-chu-shi-hua" class="header-anchor"> </a></h3>
<table>
<thead>
<tr>
<th>例子</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>vector<t> v1</t></td>
<td>v1是一个空的vector, 他潜在的元素是T类型的，执行默认初始化</td>
</tr>
<tr>
<td>vector<t> v2(v1)</t></td>
<td>v2中包含有v1的全部副本</td>
</tr>
<tr>
<td>vector<t> v2 = v1</t></td>
<td>等价于v2(v1), v2中包含v1的全部副本</td>
</tr>
<tr>
<td>vecior<t> v3(n, val)</t></td>
<td>v3包含了n个重复元素，每个元素的值都是val</td>
</tr>
<tr>
<td>vector<t> v4(n)</t></td>
<td>v4包含了n个重复地执行了值初始化的对象</td>
</tr>
<tr>
<td>vector<t> v5{a,b,c,…}</t></td>
<td>v5包含了初始值个数的元素，每个元素被赋予相应的初始值</td>
</tr>
<tr>
<td>vector<t> v6={a,b,c,…}</t></td>
<td>等价于v5{a,b,c,…}</td>
</tr>
</tbody>
</table>
<p>如果使用花括号，初始化过程会尽可能的将花括号里的值当成元素初始值的列表来处理，只有当无法执行列表初始化才会考虑其他初始化方式。如果使用了花括号的方式又不能用来初始化列表就会考虑用这样的值来构造对象了。</p>
<pre><code class="hljs cpp"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">string</span>&gt; v1&#123;<span class="hljs-string">&quot;hi&quot;</span>&#125;; <span class="hljs-comment">// 列表初始化，v1有一个元素</span>
<span class="hljs-comment">//vector&lt;string&gt; v2(&quot;hi&quot;);Error</span>
<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">string</span>&gt; v3&#123;<span class="hljs-number">10</span>&#125; <span class="hljs-comment">//等价于vector&lt;string&gt; v3(10), v3有10个元素。</span>
<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">string</span>&gt; v4&#123;<span class="hljs-number">10</span>, <span class="hljs-string">&quot;hi&quot;</span>&#125;; <span class="hljs-comment">//等价于vector&lt;string&gt; v4(10, &quot;hi&quot;), v4由10个元素。</span></code></pre>
<h3><span id="vector-de-she-ji">vector的设计</span><a href="#vector-de-she-ji" class="header-anchor"> </a></h3>
<p>普通数组的一个缺陷是，数组大小是固定的，预先申请空间很难满足实际需要，而利用指针动态申请与管理空间容易引发各种问题。而vector应该能够自动管理内存空间，我们很有可能想到使用内存池，从降低耦合的角度来讲，把内存的管理抽象为独立对象是可行的解决方案。C++ STL组件分配器就是用于分配管理内存空间的，默认情况下，vector使用的是allocator&lt;_Tp&gt;。</p>
<p>采用分配器去管理内存，在动态管理内存的思路下，预分配空间是一个很常见的策略。vector采用了预分配空间的做法。</p>
<p>vector的职责是高效存储数据，从单一职责的角度来看将遍历所有元素的行为抽象成独立对象时有更好的，因此引入了迭代器。迭代器要能够访问vector的底层结构，也就是迭代器要能访问分配器，对于具体的分配器，要实现具体的迭代器。vector需要提供方法去返回迭代器，主要提供begin()、end()、cbegin()、cend()、rbegin()、rend()、crbegin()、crend()等方法。而内部就要保存begin、end。</p>
<p>考虑普通数组的不足，数组可以使用下标访问元素，不可避免的，这会产生越界，就是所谓的缓冲区溢出，数组越界可能引发各种意想不到的异常。而vector应该采用更加的安全方法，在vector中，使用at()去访问元素，并且发生越界的时候抛出异常。</p>
<h4><span id="llvm-de-shi-xian">LLVM的实现</span><a href="#llvm-de-shi-xian" class="header-anchor"> </a></h4>
<p>以下是vector的部分类图</p>
<p>github源码：<a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/blob/main/libcxx/include/vector">https://github.com/llvm/llvm-project/blob/main/libcxx/include/vector</a></p>
<img src="http://www.plantuml.com/plantuml/svg/nLRBRXCn5DtdAomXHHdwO3-CAbNY3wZOMexdDh4wOuziDstfGooAkgf0I6nO83Q8BQoXdzD2L_m2rpEUPwQXROf8Dl7rFUU-hyCJPWoXT0RSAat7p03bAasL916na6O9in2HiL89sS3luO3Wvr4lOXHKbtQgrHvDG4xib8BMIey2mfKqjgEYTYrLsrGpEO5AvNZ0vzrgkcCFCf0i1KAtijNwi9aaYZC4E4-ZY6HQMII0kDTTfD6xuABQgACQmqH8IaB2IYvgDHFMH0tsCCoKa1Pq1GCPq_jWECiGHvr7cGPZ8AOP4pgw7TLgC-H1HPnZCPbXutf8ZewAx3Q5NLzoqArCrtHt2xfHXaQxDALph5ZUeOigUDghtz5igvxqM-G9CEp8aCoKY4iPonWNzi29ZNW9ELrbCGQ3tS8jPTObQrIcWL89sEZCs3QRAsbsGB6BnKJwYlZqDprotl8kCbKpQ2DlnXmF-cVtQ6sjRScFL26vSPR8ec4ICmHqXZ87jNJB7R7YROtMrzS3SldszEUNywkFfzUlFbsUNLoz_xfsVNR-w-B2wvvuvS2VpHvsOo4RkgQi4hII5ySLwI-TLzMGU5pAzcc9lICKarKqXjk3NfPlYcBAw9x6EHRO3xSSt0qtFdU0vPr3At3f5VRX_xJFwnGy0DazekaoUQe9M5e1EtlGgp3hgedDszoBUFBNCRDi5Fp-yS497xTK7dkLRQtaOf8nupiB5R9TCwMvLds5uUy7hNQljTnzZq8-oHoypgQUcE4GPyxjGVoTXz-mgJ9QEjRW4DA0jlceBbE19txCtxoxVFsvxTxIt7tKkdemSaO7H0kPCi8A9PSnjzZ2jj36hf8vkNy7bhKw_poj4Fntu7TNMmXwrfMQgHPoXrg5VjhENV6ir3lvs_T2qhUJjPzl3EZ5ywrdOQXX1XeVcJBYw1wRfnfudG_ymtAN-TEDvRmyVRj6jP5gO_qR4uSfsAcAZx5MtMU-UDyBmHy0">
<h3><span id="vector-de-die-dai-qi-lei-xing">vector的迭代器类型</span><a href="#vector-de-die-dai-qi-lei-xing" class="header-anchor"> </a></h3>
<h4><span id="tan-jiu-llvm-de-iterator-lei-xing">探究LLVM的iterator类型</span><a href="#tan-jiu-llvm-de-iterator-lei-xing" class="header-anchor"> </a></h4>
<p>探究vector的iterator具体类型，依据LLVM的源码进行分析。<br>
分析iterator, github源码：<a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/blob/release/12.x/libcxx/include/vector#L488">https://github.com/llvm/llvm-project/blob/release/12.x/libcxx/include/vector#L488</a></p>
<pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> _<span class="hljs-title">Tp</span>, <span class="hljs-keyword">class</span> _<span class="hljs-title">Allocator</span> /* =</span> allocator&lt;_Tp&gt; */&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">vector</span> :</span> <span class="hljs-keyword">private</span> __vector_base&lt;_Tp, _Allocator&gt; &#123;
    ...
    <span class="hljs-keyword">typedef</span> __vector_base&lt;_Tp, _Allocator&gt; __base;
    <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> __base::pointer pointer;
    <span class="hljs-keyword">typedef</span> __wrap_iter&lt;pointer&gt; iterator;
    ...
&#125;</code></pre>
<p>_wrap_iter是对pointer进行包装，然后关注这个pointer，这里的pointer是基类pointer的别名。<br>
也就是vector的iterator类型为__wrap_iter&lt;__vector_base&lt;_Tp, _Allocator&gt;::pointer&gt;, 其中__Tp是容器元素类型，_Allocator是分配器。</p>
<p>分析__vector_base&lt;_Tp, _Allocator&gt;::pointer, github源码：<a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/blob/release/12.x/libcxx/include/vector#L339">https://github.com/llvm/llvm-project/blob/release/12.x/libcxx/include/vector#L339</a></p>
<pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> _<span class="hljs-title">Tp</span>, <span class="hljs-keyword">class</span> _<span class="hljs-title">Allocator</span>&gt;</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> __<span class="hljs-title">vector_base</span> :</span> <span class="hljs-keyword">protected</span> __vector_base_common&lt;<span class="hljs-literal">true</span>&gt; &#123;
    ...
    <span class="hljs-keyword">typedef</span> _Allocator allocator_type;
    <span class="hljs-keyword">typedef</span> allocator_traits&lt;allocator_type&gt; __alloc_traits;
    <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> __alloc_traits::pointer pointer;
    ...
&#125;</code></pre>
<p>allocator_traits&lt;_Allocator&gt;对于分配器_Allocator进行封装, 因此iterator的类型为:__wrap_iter&lt; allocator_traits&lt;_Allocator&gt;::pointer&gt;<br>
分析allocator_traits&lt;_Allocator&gt;::pointer，github源码：<a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/blob/release/12.x/libcxx/include/__memory/allocator_traits.h#L231">https://github.com/llvm/llvm-project/blob/release/12.x/libcxx/include/__memory/allocator_traits.h#L231</a></p>
<pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> _<span class="hljs-title">Alloc</span>&gt;</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">allocator_traits</span>&#123;</span>
    <span class="hljs-keyword">using</span> allocator_type = _Alloc;
    <span class="hljs-keyword">using</span> value_type = <span class="hljs-keyword">typename</span> allocator_type::value_type;
    <span class="hljs-keyword">using</span> pointer = <span class="hljs-keyword">typename</span> __pointer&lt;value_type, allocator_type&gt;::type;
    ...
&#125;</code></pre>
<p>这里又是一个别名，展开 __pointer&lt; _Alloc::value_type, _Alloc&gt;::type，而_Alloc就是模板参数_Allocator, 因此iterator的类型为 __wrap_iter&lt; __pointer&lt;_Alloc::value_type, _Alloc&gt;::type&gt;<br>
分析__pointer&lt;_Alloc::value_type, _Alloc&gt;::type github源码地址：<a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/blob/release/12.x/libcxx/include/__memory/allocator_traits.h#L33">https://github.com/llvm/llvm-project/blob/release/12.x/libcxx/include/__memory/allocator_traits.h#L33</a></p>
<pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> _<span class="hljs-title">Tp</span>, <span class="hljs-keyword">class</span> _<span class="hljs-title">Alloc</span>, <span class="hljs-keyword">class</span> _<span class="hljs-title">RawAlloc</span> =</span> <span class="hljs-keyword">typename</span> remove_reference&lt;_Alloc&gt;::type, <span class="hljs-keyword">bool</span> = __has_pointer&lt;_RawAlloc&gt;::value&gt;
struct __pointer &#123;
    <span class="hljs-keyword">using</span> type = <span class="hljs-keyword">typename</span> _RawAlloc::pointer;
&#125;;
<span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> _<span class="hljs-title">Tp</span>, <span class="hljs-keyword">class</span> _<span class="hljs-title">Alloc</span>, <span class="hljs-keyword">class</span> _<span class="hljs-title">RawAlloc</span>&gt;</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> __<span class="hljs-title">pointer</span>&lt;</span>_Tp, _Alloc, _RawAlloc, <span class="hljs-literal">false</span>&gt; &#123;
    <span class="hljs-keyword">using</span> type = _Tp*;
&#125;;</code></pre>
<p>关注第一个__pointer结构， 本处type作为_RawAlloc::pointer的引用，而_RawAlloc的默认参数为typename remove_reference&lt;_Alloc&gt;::type，而_Alloc就是模板参数_Allocator,<br>
因此iterator的类型为__wrap_iter&lt; remove_reference&lt;_Allocator&gt;::type::pointer &gt;</p>
<p>分析remove_reference&lt;_Allocator&gt;<sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="https://blog.csdn.net/slslslyxz/article/details/105778734">[3]</span></a></sup></p>
<pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">remove_reference</span></span>
<span class="hljs-class">&#123;</span>
<span class="hljs-keyword">public</span>:
   <span class="hljs-keyword">typedef</span> T type;
&#125;;
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">remove_reference</span>&lt;</span>T&amp;&gt;
&#123;
<span class="hljs-keyword">public</span>:
   <span class="hljs-keyword">typedef</span> T type;
&#125;;</code></pre>
<p>remove_reference就是去除引用。因此iterator的类型为__wrap_iter&lt; _Allocator::pointer &gt;, 不过这是去除引用的_Alloctor</p>
<p>然后探究_Alloctor，默认分配器为alloctor&lt;_Tp&gt;</p>
<pre><code class="hljs cpp"><span class="hljs-keyword">template</span> &lt;<span class="hljs-class"><span class="hljs-keyword">class</span> _<span class="hljs-title">Tp</span>&gt;</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> _<span class="hljs-title">LIBCPP_TEMPLATE_VIS</span> <span class="hljs-title">allocator</span>&#123;</span>
    <span class="hljs-keyword">typedef</span> _Tp* pointer;
&#125;</code></pre>
<p>因此，vector的迭代器类型就是__wrap_iter&lt; _Tp* &gt;.</p>
<p>__wrap_iter是一个ConcreteIterator，拿到了_Tp* 就可以对vector进行遍历了。对于_Tp*进行了封装，并提供了各种迭代器功能。<br>
github源码：<a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/blob/main/libcxx/include/iterator#L1265">https://github.com/llvm/llvm-project/blob/main/libcxx/include/iterator#L1265</a></p>
<h4><span id="tan-jiu-gnu-c-de-iterator-lei-xing">探究GNU C++的iterator类型</span><a href="#tan-jiu-gnu-c-de-iterator-lei-xing" class="header-anchor"> </a></h4>
<p>分析iterator，github源码：<a target="_blank" rel="noopener" href="https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/include/bits/stl_vector.h#L419">https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/include/bits/stl_vector.h#L419</a></p>
<pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> _Tp, <span class="hljs-keyword">typename</span> _Alloc = <span class="hljs-built_in">std</span>::allocator&lt;_Tp&gt; &gt;
class <span class="hljs-built_in">vector</span> : <span class="hljs-keyword">protected</span> _Vector_base&lt;_Tp, _Alloc&gt; &#123;
    ...
    <span class="hljs-keyword">typedef</span> _Vector_base&lt;_Tp, _Alloc&gt; _Base;
    <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> _Base::pointer pointer;
    <span class="hljs-keyword">typedef</span> __gnu_cxx::__normal_iterator&lt;pointer, <span class="hljs-built_in">vector</span>&gt; iterator;
    ...
&#125;</code></pre>
<p>iterator的类型为:__gnu_cxx::__normal_iterator&lt;_Vector_base&lt;_Tp, _Alloc&gt;::pointer, vector&gt;</p>
<p>继续分析_Vector_base&lt;_Tp, _Alloc&gt;::pointer，github源码：<a target="_blank" rel="noopener" href="https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/include/bits/stl_vector.h#L83">https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/include/bits/stl_vector.h#L83</a></p>
<pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> _Tp, <span class="hljs-keyword">typename</span> _Alloc&gt;
<span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">Vector_base</span>&#123;</span>
    ...
    <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> __gnu_cxx::__alloc_traits&lt;_Tp_alloc_type&gt;::pointer pointer;
    ...
&#125;</code></pre>
<p>iterator的类型为:__gnu_cxx::__normal_iterator&lt; __gnu_cxx::__alloc_traits&lt;_Tp_alloc_type&gt;::pointer, vector&gt;</p>
<p>继续分析 __gnu_cxx::__alloc_traits&lt;_Tp_alloc_type&gt;::pointer，github源码：<a target="_blank" rel="noopener" href="https://github.com/gcc-mirror/gcc/blob/releases/gcc-11/libstdc%2B%2B-v3/include/ext/alloc_traits.h#L47">https://github.com/gcc-mirror/gcc/blob/releases/gcc-11/libstdc%2B%2B-v3/include/ext/alloc_traits.h#L47</a></p>
<pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> _Alloc, <span class="hljs-keyword">typename</span> = <span class="hljs-keyword">typename</span> _Alloc::value_type&gt;
struct __alloc_traits: <span class="hljs-built_in">std</span>::allocator_traits&lt;_Alloc&gt;&#123;
    ...
    <span class="hljs-keyword">typedef</span> <span class="hljs-built_in">std</span>::allocator_traits&lt;_Alloc&gt; _Base_type;
    <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">typename</span> _Base_type::pointer pointer;
    ...
&#125;</code></pre>
<p>iterator的类型为:__gnu_cxx::__normal_iterator&lt; std::allocator_traits&lt;_Alloc&gt;::pointer, vector&gt;</p>
<p>继续分析std::allocator_traits&lt;_Alloc&gt;::pointer，由于_Alloc实际上是allocator&lt;_Tp&gt;， 采用部分实例化的版本。<br>
github源码：<a target="_blank" rel="noopener" href="https://github.com/gcc-mirror/gcc/blob/releases/gcc-11/libstdc%2B%2B-v3/include/bits/alloc_traits.h#L416">https://github.com/gcc-mirror/gcc/blob/releases/gcc-11/libstdc%2B%2B-v3/include/bits/alloc_traits.h#L416</a></p>
<pre><code class="hljs cpp"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> _Tp&gt;
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">allocator_traits</span>&lt;</span>allocator&lt;_Tp&gt;&gt; &#123;
    ...
    <span class="hljs-comment">/// The allocator&#x27;s pointer type.</span>
    <span class="hljs-keyword">using</span> pointer = _Tp*;
    ...
&#125;</code></pre>
<p>iterator的类型为:__gnu_cxx::__normal_iterator&lt;_Tp*, std::vector&lt; _Tp , std::allocator&lt;_Tp&gt; &gt; &gt;<br>
拿到了_Tp*，就可以对vector进行遍历了。</p>
<p>Primer c++ 第5版 page375</p>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">C++容器详解 https://www.cnblogs.com/sea520/p/12711554.html<a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">basic footnote content<a href="#fnref:2" rev="footnote"> ↩</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">https://blog.csdn.net/slslslyxz/article/details/105778734<a href="#fnref:3" rev="footnote"> ↩</a></span></li></ol></div></div><link rel="stylesheet" href="/ChrisJaunes/css/spoiler.css" type="text/css"><script src="/ChrisJaunes/js/spoiler.js" type="text/javascript" async></script>
        </div>
        <div class="article-tags">
            <ul class="tags-list cl">
                <li><a href="/ChrisJaunes/tags/C++/"><i class="fa fa-tag"></i>C++</a></li>
            </ul>
        </div>
        <div class="article-pagination cl">
            <div class="pagination-prev">
                <a href="/ChrisJaunes/2021/04/25/%E6%A0%87%E5%87%86%E5%BA%93-%E5%AE%B9%E5%99%A8%E6%B5%85%E6%9E%90-2-%E9%A1%BA%E5%BA%8F%E5%AE%B9%E5%99%A8/">上一篇：标准库-容器浅析-2-C++顺序容器</a>
            </div>
            <div class="pagination-next">
                <a href="/ChrisJaunes/2021/04/25/%E6%A0%87%E5%87%86%E5%BA%93-%E5%AE%B9%E5%99%A8%E6%B5%85%E6%9E%90-1-%E6%A6%82%E8%BF%B0/">下一篇：标准库-容器浅析-1-概述</a>
            </div>
        </div> 
        
            <link rel="stylesheet" href="https://unpkg.com/gitalk@latest/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
<script src="https://priesttomb.github.io/js/md5.min.js"></script>
<div id="gitalk-container"></div>
<script type="text/javascript">
    new Gitalk({
        clientID: '0ba2ec4192b1d2fb9cb6',
        clientSecret: '85deadc0e6ed5bdf825a822ab2fdfbad69401fb9',
        repo: 'ChrisJaunes',
        owner: 'ChrisJaunes',
        admin: 'ChrisJaunes',
        id: md5(location.pathname),
        distractionFreeMode: true,
        proxy: 'https://vercel.prohibitorum.top/github_access_token'
    }).render('gitalk-container')
</script>
        
    </div>

</article>
    </section>
        
<section class="tool-area">

    <div class="toolbar">
        

        
        <div class="widget-post widget" style="order: 1 ">
            <h2 class="widget-title"><i class="fa fa-file-text"></i> Recent articles</h2>
            <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/ChrisJaunes/2023/02/20/python-mock-%E7%94%A8%E6%B3%95%E6%B5%85%E6%9E%90-%E6%9B%BF%E6%8D%A2%E8%A2%AB%E6%B5%8B%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%9F%90%E4%BA%9B%E9%83%A8%E5%88%86/">python-mock-用法浅析-替换被测系统的某些部分</a></li><li class="post-list-item"><a class="post-list-link" href="/ChrisJaunes/2022/10/30/Pyodide-%E6%BA%90%E7%A0%81%E6%B5%85%E6%9E%90/">Pyodide-源码浅析</a></li><li class="post-list-item"><a class="post-list-link" href="/ChrisJaunes/2022/09/05/DRF-ModelSerializer-%E6%BA%90%E7%A0%81%E6%B5%85%E6%9E%90-%E5%BA%8F%E5%88%97%E5%8C%96/">DRF-ModelSerializer-源码浅析-序列化</a></li><li class="post-list-item"><a class="post-list-link" href="/ChrisJaunes/2022/08/02/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-mock%E6%B5%85%E6%9E%90-1-%E6%A6%82%E8%BF%B0/">单元测试-mock浅析-1-概述</a></li><li class="post-list-item"><a class="post-list-link" href="/ChrisJaunes/2022/07/07/Adfuller-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Adfuller-学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/ChrisJaunes/2022/04/26/ZooKeeper-%E6%BA%90%E7%A0%81%E6%B5%85%E6%9E%90-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E7%9B%B8%E5%85%B3/">ZooKeeper-源码浅析-数据模型相关</a></li><li class="post-list-item"><a class="post-list-link" href="/ChrisJaunes/2022/04/25/ZooKeeper-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B/">ZooKeeper-数据模型</a></li><li class="post-list-item"><a class="post-list-link" href="/ChrisJaunes/2022/04/25/ZooKeeper-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">ZooKeeper-环境搭建</a></li></ul>
        </div>
        

        
        <div class="widget-tags widget" style="order: 2 ">
            <h2 class="widget-title"><i class="fa fa-tags"></i> Tag</h2>
            <a href="/ChrisJaunes/tags/Blockly/" style="font-size: 14px;">Blockly</a> <a href="/ChrisJaunes/tags/C/" style="font-size: 14px;">C++</a> <a href="/ChrisJaunes/tags/D3/" style="font-size: 10px;">D3</a> <a href="/ChrisJaunes/tags/Http/" style="font-size: 16px;">Http</a> <a href="/ChrisJaunes/tags/HttpServer/" style="font-size: 16px;">HttpServer</a> <a href="/ChrisJaunes/tags/Java/" style="font-size: 20px;">Java</a> <a href="/ChrisJaunes/tags/Jupyter/" style="font-size: 12px;">Jupyter</a> <a href="/ChrisJaunes/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/ChrisJaunes/tags/Mock/" style="font-size: 10px;">Mock</a> <a href="/ChrisJaunes/tags/Net/" style="font-size: 12px;">Net</a> <a href="/ChrisJaunes/tags/Presto/" style="font-size: 12px;">Presto</a> <a href="/ChrisJaunes/tags/Pyodide/" style="font-size: 10px;">Pyodide</a> <a href="/ChrisJaunes/tags/Python/" style="font-size: 18px;">Python</a> <a href="/ChrisJaunes/tags/Servlet/" style="font-size: 12px;">Servlet</a> <a href="/ChrisJaunes/tags/Skulpt/" style="font-size: 10px;">Skulpt</a> <a href="/ChrisJaunes/tags/Sql%E8%A7%A3%E6%9E%90/" style="font-size: 12px;">Sql解析</a> <a href="/ChrisJaunes/tags/TensorFlow/" style="font-size: 10px;">TensorFlow</a> <a href="/ChrisJaunes/tags/ZooKeeper/" style="font-size: 14px;">ZooKeeper</a> <a href="/ChrisJaunes/tags/container/" style="font-size: 10px;">container</a> <a href="/ChrisJaunes/tags/django/" style="font-size: 10px;">django</a> <a href="/ChrisJaunes/tags/metakernel/" style="font-size: 10px;">metakernel</a> <a href="/ChrisJaunes/tags/python/" style="font-size: 10px;">python</a> <a href="/ChrisJaunes/tags/test/" style="font-size: 10px;">test</a> <a href="/ChrisJaunes/tags/web/" style="font-size: 10px;">web</a> <a href="/ChrisJaunes/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 14px;">分布式</a> <a href="/ChrisJaunes/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">单元测试</a> <a href="/ChrisJaunes/tags/%E5%BA%8F%E5%88%97%E5%8C%96/" style="font-size: 10px;">序列化</a> <a href="/ChrisJaunes/tags/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%88%86%E6%9E%90/" style="font-size: 10px;">时间序列分析</a>
        </div>
        

        
            <div class="widget-categories widget" style="order: 3 ">
                <h2 class="widget-title"><i class="fa fa-folder-open"></i> Categories</h2>
                 <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Blockly/">Blockly</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Blockly/BlocklyJupyter/">BlocklyJupyter</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/C/">C++</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/C/%E6%A0%87%E5%87%86%E5%BA%93/">标准库</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/D3/">D3</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Java/">Java</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Java/Http/">Http</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Java/Http/HttpServer/">HttpServer</a><span class="category-list-count">4</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Java/Servlet/">Servlet</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Presto/">Presto</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Presto/SqlParser/">SqlParser</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Pyodide/">Pyodide</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Python/">Python</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Python/Docx/">Docx</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Python/Json/">Json</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Python/Mock/">Mock</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Python/%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/">内置函数</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/Skulpt/">Skulpt</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/TensorFlow/">TensorFlow</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/TensorFlow/env/">env</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/django/">django</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/programing-language/">programing_language</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/programing-language/%E6%AF%94%E8%BE%83%E5%AD%A6%E4%B9%A0/">比较学习</a><span class="category-list-count">6</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/%E5%88%86%E5%B8%83%E5%BC%8F/ZooKeeper/">ZooKeeper</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">单元测试</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/ChrisJaunes/categories/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%88%86%E6%9E%90/">时间序列分析</a><span class="category-list-count">1</span></li></ul> 
            </div>         
        
    </div>
</section>
</div>


<footer class="footer">
	<p class="footer-intro">
		
		@2023 ChrisJaunes.
	</p>
	<p class="footer-intro">
			Powered By <a href="https://github.com/ChrisJaunes" target="_blank"> ChrisJaunes </a> |
			Hexo Powered By <a href="https://hexo.io/zh-cn/" target="_blank">hexo</a> |
			Theme Powered by ChrisJaunes 
	</p>
	<p class="footer-intro">
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
		<span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次 &nbsp;|&nbsp;</span>
		<span id="busuanzi_container_site_uv">访客数<span id="busuanzi_value_site_uv"></span>人次&nbsp;|&nbsp;</span>
		<span id="busuanzi_container_page_pv">本文总阅读量<span id="busuanzi_value_page_pv"></span>次</span>
	</p>
</footer>




<div class="extend-tools" id="extend-tools" style="display: none;">
    <ul>
        <li class="tools-returnTop" title="Back to top"><i class="fa fa-angle-double-up"></i></li>
    </ul>
</div>

	</div>


<script src="/ChrisJaunes/js/org/jquery.min.js"></script>


<script src="/ChrisJaunes/js/extend.js"></script>

</body>
</html>